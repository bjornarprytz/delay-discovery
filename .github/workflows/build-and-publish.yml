# https://github.com/seanmaxwell/godot-example-auto-deploy/blob/main/.github/workflows/godot-ci.yml

name: Publish to itch.io
on:
  push:
    tags:
      - "v*"

env:
  ITCHIO_USERNAME: thewarlock
  GAME_NAME: delay-discovery
  PROJECT_PATH: "./src/"
  GODOT_VERSION: 4.3-stable

jobs:
  export-game:
    uses: ./.github/workflows/export-game.yml
    with:
      platforms: web # Other options: windows, mac, linux

  itch-io-upload:
    name: Upload to Itch.io
    needs: [export-game]
    runs-on: ubuntu-latest
    strategy:
      matrix:
        platform: [web] # Other options: windows, mac, linux
    steps:
      - name: Download Artifact (${{ matrix.platform }})
        uses: actions/download-artifact@v4
        with:
          name: ${{ env.GAME_NAME }}.${{ github.ref_name }}.${{ matrix.platform }}
      - name: Butler Upload
        uses: josephbmanley/butler-publish-itchio-action@v1.0.3
        env:
          BUTLER_CREDENTIALS: ${{ secrets.BUTLER_API_KEY }}
          CHANNEL: ${{ matrix.platform }}
          ITCH_GAME: ${{ env.GAME_NAME }}
          ITCH_USER: ${{ env.ITCHIO_USERNAME }}
          PACKAGE: .
          VERSION: ${{ github.ref_name }}
